<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Chaoyn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="layout: posttitle: “centos nginx简介”date: 2017/11/01description: “nginx配置介绍，搭建网站” tag: linux什么是nginxNginx (engine x) 是一个高性能的 HTTP 和 反向代理 服务器，也是一个 IMAP/POP3/SMTP 服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru">
<meta property="og:type" content="article">
<meta property="og:title" content="Chaoyn&#39;s Blog">
<meta property="og:url" content="http://blog.yuaning.vip/2019/02/21/2017-11-01-nginx/index.html">
<meta property="og:site_name" content="Chaoyn&#39;s Blog">
<meta property="og:description" content="layout: posttitle: “centos nginx简介”date: 2017/11/01description: “nginx配置介绍，搭建网站” tag: linux什么是nginxNginx (engine x) 是一个高性能的 HTTP 和 反向代理 服务器，也是一个 IMAP/POP3/SMTP 服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://blog.yuaning.vip/images/nginx/架构.png">
<meta property="og:image" content="http://blog.yuaning.vip/images/nginx/模块.png">
<meta property="og:image" content="http://blog.yuaning.vip/images/nginx/文件结构.png">
<meta property="og:updated_time" content="2018-07-17T09:22:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chaoyn&#39;s Blog">
<meta name="twitter:description" content="layout: posttitle: “centos nginx简介”date: 2017/11/01description: “nginx配置介绍，搭建网站” tag: linux什么是nginxNginx (engine x) 是一个高性能的 HTTP 和 反向代理 服务器，也是一个 IMAP/POP3/SMTP 服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru">
<meta name="twitter:image" content="http://blog.yuaning.vip/images/nginx/架构.png">
  
    <link rel="alternate" href="/atom.xml" title="Chaoyn&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chaoyn&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">study hard and make progress every day !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.yuaning.vip"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2017-11-01-nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/21/2017-11-01-nginx/" class="article-date">
  <time datetime="2019-02-21T05:40:51.880Z" itemprop="datePublished">2019-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>layout: post<br>title: “centos nginx简介”<br>date: 2017/11/01<br>description: “nginx配置介绍，搭建网站”</p>
<h2 id="tag-linux"><a href="#tag-linux" class="headerlink" title="tag: linux"></a>tag: linux</h2><h3 id="什么是nginx"><a href="#什么是nginx" class="headerlink" title="什么是nginx"></a>什么是nginx</h3><p>Nginx (engine x) 是一个高性能的 <strong>HTTP</strong> 和 <strong>反向代理</strong> 服务器，也是一个 <strong>IMAP/POP3/SMTP</strong> 服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。2011年6月1日，nginx 1.0.4发布。</p>
<p>其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等</p>
<p>目前淘宝在nginx做了二次开发：tengine</p>
<h3 id="nginx的特性"><a href="#nginx的特性" class="headerlink" title="nginx的特性"></a>nginx的特性</h3><table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>跨平台：</td>
<td>Nginx 可以在大多数 Unix like OS编译运行， 而且也有Windows的移植版本。 配置异常简单， 非常容易上手。 配置风格简单， 神一般的配置易读性</td>
</tr>
<tr>
<td>高并发连接：</td>
<td>数据复制时， 官方测试能够支撑5万并发连接， 在实际生产环境中跑到2～3万并发连接数.(这得益于Nginx使用了最新的epoll模型)通信机制采用epoll模型， 支持更大的并发连接。</td>
</tr>
<tr>
<td>master/worker结构：</td>
<td>一个master进程， 生成一个或多个worker进程功能模块化： nginx的内部结构是由核心部分和一系列的功能模块所组成。 这样划分是为了使得每个模块的功能相对简单， 便于开发， 同时也便于对系统进行功能扩展。</td>
</tr>
<tr>
<td>成本低廉：</td>
<td>Nginx可实现负载均衡功能， 可以免费使用。 而购买F5 BIG-IP、 NetScaler等硬件负载均衡交换机则需要十多万至几十万人民币</td>
</tr>
<tr>
<td>内置的健康检查功能：</td>
<td>如果 Nginx Proxy 后端的某台 Web 服务器宕机了，不会影响前端访问。</td>
</tr>
<tr>
<td>节省带宽：</td>
<td>有缓存模块， 支持 GZIP 压缩， 可实现浏览器本地缓存的Header 头。</td>
</tr>
<tr>
<td>稳定性高：</td>
<td>用于反向代理（负载均衡） ， 宕机的概率微乎其微</td>
</tr>
</tbody>
</table>
<p><img src="/images/nginx/架构.png" alt></p>
<p><img src="/images/nginx/模块.png" alt></p>
<p>Nginx模块主要有4种角色：</p>
<p>(1) core(核心模块)：构建nginx基础服务、管理其他模块。<br>(2) handlers(处理模块)： 用于处理HTTP请求，然后产生输出。<br>(3) load-balancers（负载均衡模块）：当有多于一台的后端备选服务器时，选择一台转发HTTP请求。<br>(4) filters（过滤模块）： 过滤handler产生的输出。  </p>
<h3 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h3><p>nginx安装常用两种方式，<strong>yum安装</strong> 和 <strong>源码包安装</strong></p>
<p><strong>yum 安装</strong>：通常是在线安装，好处是安装方式简单，不易出错；常用的安装yum源为epel</p>
<p><strong>源码包安装</strong>：是先将 nginx 的源码下载下来，在自己的系统里编译生成可执行文件，然后执行，好处是因为是在自己的系统上编译的，更符合自己系统的性能，也就是说在自己的系统上执行 nginx 服务性能效率更好。（推荐，需要安装开发环境）</p>
<p><strong>区别</strong>：路径和启动方式不同，支持的模块也不同。</p>
<h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><p>主配置文件： nginx.conf<br>扩展相关配置文件： <code>include conf.d/*.conf</code><br>协议配置： fastcgi， uwsgi， scgi等协议相关的配置文件<br>类型配置： mime.types： 支持的mime类型  </p>
<p>主配置文件结构：  </p>
<pre><code>main ： #主配置段， 也即全局配置段； 正常运行必备配置优化性能配置， 用于调试和定位的配置。  
event {  
...  
}； 事件驱动相关的配置；  
http {  
...  
}； http/https 协议相关的配置段；  
</code></pre><p><img src="/images/nginx/文件结构.png" alt></p>
<h4 id="1）-全局配置"><a href="#1）-全局配置" class="headerlink" title="1） 全局配置"></a>1） 全局配置</h4><p>user nobody nobody; #Nginx的worker进程运行用户以及用户组</p>
<p>worker_processes 2;  #Nginx开启的进程数<br>worker_processes auto;  #自动分配进程数，一般根据cpu核数</p>
<pre><code>#也可以下参数指定了哪个cpu分配给哪个进程，
#worker_processes 4 #4核CPU
#worker_cpu_affinity 0001 0010 0100 1000
</code></pre><p>error_log logs/error.log info; #定义全局错误日志定义类型，[debug|info|notice|warn|crit]</p>
<p>pid logs/nginx.pid; #指定进程ID存储文件位置</p>
<h4 id="2）-服务配置"><a href="#2）-服务配置" class="headerlink" title="2） 服务配置"></a>2） 服务配置</h4><p>非虚拟主机的配置或公共配置， 需要定义在server之外， http之内；</p>
<pre><code>http {
directive value;
...
server {
}s
erver {
}
...
}}
</code></pre><p>必须使用虚拟主机来配置站点； 每个虚拟主机使用一个server {}段配置；</p>
<h4 id="http段参数配置："><a href="#http段参数配置：" class="headerlink" title="http段参数配置："></a>http段参数配置：</h4><p>include mime.types; #文件扩展名与文件类型映射表<br>default_type application/octet-stream; #默认文件类型  </p>
<p>日志相关定义</p>
<pre><code>log_format main &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;
                &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;
                &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;
定义日志的格式。 后面定义要输出的内容。
1.$remote_addr 与$http_x_forwarded_for 用以记录客户端的ip地址；
2.$remote_user ： 用来记录客户端用户名称；
3.$time_local ： 用来记录访问时间与时区；
4.$request ： 用来记录请求的url与http协议；
5.$status ： 用来记录请求状态；
6.$body_bytes_sent ： 记录发送给客户端文件主体内容大小；
7.$http_referer ： 用来记录从那个页面链接访问过来的；
8.$http_user_agent ： 记录客户端浏览器的相关信息
</code></pre><p>access_log logs/access.log main; #连接日志的路径， 指定的日志格式放在最后。<br>error_log logs/error.log crit; #只记录更为严重的错误日志， 减少IO压力<br>charset utf-8;#默认编码<br>server_names_hash_bucket_size 128;#服务器名字的hash表大小<br>client_max_body_size 8m;#客户端请求单个文件的最大字节数<br>client_header_buffer_size 32k;#指定来自客户端请求头的hearerbuffer大小<br>large_client_header_buffers 4 64k;#指定客户端请求中较大的消息头的缓存最大数量和大小。<br>sendfile on;#开启高效传输模式。<br>tcp_nopush on; #防止网络阻塞<br>tcp_nodelay on;  #禁用了Nagle算法<br>client_header_timeout 10;#客户端请求头读取超时时间<br>client_body_timeout 10;#设置客户端请求主体读取超时时间<br>send_timeout 10;#响应客户端超时时间  </p>
<h4 id="FastCGI相关参数是为了改善网站的性能：-减少资源占用，-提高访问速度。"><a href="#FastCGI相关参数是为了改善网站的性能：-减少资源占用，-提高访问速度。" class="headerlink" title="FastCGI相关参数是为了改善网站的性能： 减少资源占用， 提高访问速度。"></a>FastCGI相关参数是为了改善网站的性能： 减少资源占用， 提高访问速度。</h4><pre><code>fastcgi_connect_timeout 300;
fastcgi_send_timeout 300;
fastcgi_read_timeout 300;
fastcgi_buffer_size 64k;
fastcgi_buffers 4 64k;
fastcgi_busy_buffers_size 128k;
fastcgi_temp_file_write_size 128k;
</code></pre><h4 id="gzip模块设置"><a href="#gzip模块设置" class="headerlink" title="gzip模块设置"></a>gzip模块设置</h4><blockquote>
<p>gzip on;#开启gzip压缩输出<br>gzip_min_length 1k; #最小压缩文件大小<br>gzip_buffers 4 16k;#压缩缓冲区<br>gzip_http_version 1.0;#压缩版本（默认1.1， 前端如果是squid2.5请使用1.0）<br>gzip_comp_level 2;#压缩等级 1-9 等级越高， 压缩效果越好， 节约宽带， 但CPU消耗大<br>gzip_types text/plain application/x-javascript text/css application/xml;#压缩类型， 默认就已经包含text/html， 所以下面就不用再写了， 写上去也不会有问题， 但是会有一个warn。<br>gzip_vary on;32#前端缓存服务器缓存经过压缩的页面  </p>
</blockquote>
<h4 id="虚拟主机相关的配置："><a href="#虚拟主机相关的配置：" class="headerlink" title="虚拟主机相关的配置："></a>虚拟主机相关的配置：</h4><p>1、 server {}<br>定义一个虚拟主机； nginx支持使用基于主机名或IP的虚拟主机；<br>2、 listen<br>listen address[:port];<br>listen port<br>default_server： 定义此server为http中默认的server； 如果所有的server中没有任何一个listen使用此参数， 那么第一个server即为默认server;</p>
<p>3、 server_name […];</p>
<p>server_name可以跟多个主机名， 名称中可以使用通配符和正则表达式(通常以~开头)； 当<br>nginx收到一个请求时， 会取出其首部的server的值， 而后跟众server_name进行比较；</p>
<p>比较优先次序方式：</p>
<pre><code>(1) 先做精确匹配； www.magedu.com
(2) 左侧通配符匹配； *.magedu.com
(3) 右侧通配符匹配； www.abc.com, www.*
(4) 正则表达式匹配: ~^.*\.magedu\.com$
</code></pre><p>4、<br>(1)location [ = | ~ | ~* | ^~ ] uri { … }<br>(2)location @name { … }</p>
<p>功能： 允许根据用户请求的URI来匹配指定的各location以进行访问配置； 匹配到时， 将被location块中的配置所处理</p>
<pre><code>=： 精确匹配；
~： 正则表达式模式匹配， 匹配时区分字符大小写
~*： 正则表达式模式匹配， 匹配时忽略字符大小写
^~: URI前半部分匹配， 匹配时忽略字符大小写。 不检查正则表达式 
匹配优先级：
= (大于) ^~ (大于) ~ (大于) 不带符号
</code></pre><h4 id="举例："><a href="#举例：" class="headerlink" title="举例："></a>举例：</h4><p>location = / {}<br>location / {}<br>location ^~ /images/{}<br>location ~* .(jpg|gif|npg|jpeg)$ {}<br>请求：<br>1、 /<br>2、 /doc/index.html<br>3、 /images/1.gif<br>4、 /doc/1.jpg  </p>
<p>以上一一对应</p>
<h3 id="文件路径定义"><a href="#文件路径定义" class="headerlink" title="文件路径定义"></a>文件路径定义</h3><p>server段内<br>1、 root path  设置web资源路径； 用于指定请求的根文档目录；</p>
<pre><code>location / {
    root /www/htdocs;（本机的文件路径）
}
location ^~ /images/ {
    root /web;
} 
</code></pre><p>2、 alias path  只能用于location中， 用于路径别名；</p>
<pre><code>location / {
    root /www/htdocs;
}
location ^~ /images/ {
    alias /web/;
}
</code></pre><p>3、 index file …;  定义默认页面， 可参跟多个值；<br>4、 error_page code … [=[response]] uri;</p>
<p>错误页重定向： 当对于某个请求返回错误时， 如果匹配上了error_page指令中设定的code， 则重定向到新的URI中。</p>
<p>例： error_page 404 /404.html;当用户请求一个不存在的资源时， 会自动跳转到自定义的404.html页面。<br><strong>注意</strong>：跳转的状态码还是原来的状态码， 即使是跳转成功  </p>
<h3 id="以上就是nginx的基本配置问题。下一篇介绍lnmp架构搭建"><a href="#以上就是nginx的基本配置问题。下一篇介绍lnmp架构搭建" class="headerlink" title="以上就是nginx的基本配置问题。下一篇介绍lnmp架构搭建"></a>以上就是nginx的基本配置问题。下一篇介绍lnmp架构搭建</h3><p><a href="../lnmp" title="lnmp搭建小米商城系统">lnmp搭建小米商城系统</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.yuaning.vip/2019/02/21/2017-11-01-nginx/" data-id="cjse784d90000oxyn7jmeumw9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/21/2018-07-17-nginx-optimize/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2019/02/20/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/21/2018-07-17-nginx-optimize/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/21/2017-11-01-nginx/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/20/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Chaoyn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>